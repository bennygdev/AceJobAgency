@page
@model AppSec_Assignment2.Pages.TwoFactorAuthModel
@{
    ViewData["Title"] = "Two-Factor Authentication";
}

<div class="container mx-auto px-4 py-12">
    <div class="mx-auto max-w-md">
        <!-- Header -->
        <div class="mb-8 text-center">
            <div class="mx-auto flex h-14 w-14 items-center justify-center rounded-full bg-primary/10 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="m9 12 2 2 4-4"/></svg>
            </div>
            <h1 class="text-3xl font-bold tracking-tight">Two-Factor Authentication</h1>
            <p class="mt-2 text-muted-foreground">Enter the verification code sent to<br/><strong>@Model.MaskedEmail</strong></p>
        </div>

        @if (TempData["Message"] != null)
        {
            <div class="alert mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
                <h2>@TempData["Message"]</h2>
            </div>
        }

        <!-- Card -->
        <div class="card w-full">
            <header>
                <h2>Verification Code</h2>
                <p>Enter the 6-digit code from your email</p>
            </header>
            <section>
                <form method="post" id="verifyForm" class="form grid gap-6">
                    @Html.AntiForgeryToken()
                    
                    <div asp-validation-summary="ModelOnly" class="validation-summary-errors"></div>

                    <div class="grid gap-2">
                        <label asp-for="Input.Code">Code</label>
                        <input asp-for="Input.Code" type="text" maxlength="6" placeholder="000000" autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" class="text-center text-2xl tracking-[0.5em] font-mono" />
                        <span asp-validation-for="Input.Code"></span>
                    </div>
                </form>
            </section>
            <footer class="flex flex-col items-center gap-4">
                <button type="submit" form="verifyForm" class="btn w-full">Verify Code</button>
                    
                <div class="mt-4 text-center">
                    <a asp-page="/Login" class="text-sm text-muted-foreground hover:text-foreground">‚Üê Back to Login</a>
                </div>
            </footer>
        </div>

        <!-- Notice -->
        <div class="mt-6 flex items-center justify-center gap-2 text-sm text-muted-foreground">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span>Code expires in 5 minutes</span>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        const codeInput = document.querySelector('input[name="Input.Code"]');
        if (codeInput) {
            codeInput.focus();
            codeInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '');
                if (this.value.length === 6) {
                    document.getElementById('verifyForm').submit();
                }
            });
        }
    </script>
}
